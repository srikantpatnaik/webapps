<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIRE Calculator</title>
    <style>
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a2128;
            --bg-tertiary: #21262d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --accent-color: #58a6ff;
            --accent-light: #79c0ff;
            --accent-hover: #79b8ff;
            --border-color: #303946;
            --success-color: #3fb950;
            --success-light: #56d364;
            --success-hover: #4ac25e;
            --danger-color: #f85149;
            --danger-light: #ff7b72;
            --danger-hover: #ff6b63;
            --card-shadow: 0 8px 32px rgba(1, 4, 9, 0.4);
            --input-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            --hover-glow: 0 0 0 4px rgba(88, 166, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary), #0a0e14);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent-light);
            font-size: 1.4rem;
            font-weight: 600;
            text-shadow: 0 10px rgba(88, 166, 255, 0.3);
            letter-spacing: 0.5px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 9px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        input, select, button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(145deg, var(--bg-primary), #0c1015);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: var(--input-shadow);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: var(--input-shadow), var(--hover-glow);
            background: linear-gradient(145deg, var(--bg-primary), #0a0d11);
        }

        button {
            background: linear-gradient(135deg, var(--accent-color), #3d85e0);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(8, 166, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        button:hover {
            background: linear-gradient(135deg, var(--accent-light), #5a9bed);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(8, 166, 255, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: linear-gradient(145deg, var(--bg-tertiary), #1d262f);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        th, td {
            padding: 18px;
            text-align: center; /* Center align content */
            border-bottom: 1px solid rgba(48, 57, 69, 0.6);
        }

        th {
            background: linear-gradient(to bottom, var(--bg-secondary), #151c24);
            color: var(--accent-light);
            font-weight: 600;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:nth-child(even) {
            background-color: rgba(34, 43, 53, 0.4);
        }

        tr:hover {
            background: linear-gradient(90deg, rgba(88, 166, 255, 0.1), transparent);
        }
        
        .negative-value {
            color: var(--danger-light); /* Lighter red for negative values */
            font-weight: 600;
            text-shadow: 0 0 5px rgba(248, 81, 73, 0.3);
        }

        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 0.9rem;
            min-width: auto;
            border-radius: 6px;
        }

        .btn-add {
            background: linear-gradient(135deg, var(--success-color), #2ea043);
            box-shadow: 0 4px 6px rgba(35, 134, 54, 0.2);
        }

        .btn-add:hover {
            background: linear-gradient(135deg, var(--success-hover), #3fb950);
            box-shadow: 0 6px 12px rgba(35, 134, 54, 0.3);
        }

        .btn-delete {
            background: linear-gradient(135deg, var(--danger-color), #f85149);
            box-shadow: 0 4px 6px rgba(218, 54, 51, 0.2);
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, var(--danger-hover), #ff7b72);
            box-shadow: 0 6px 12px rgba(218, 54, 51, 0.3);
        }

        .results-table {
            margin-top: 15px;
        }

        .summary-card {
            background: linear-gradient(135deg, var(--bg-tertiary), #1a1f27);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
        }

        .summary-title {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 14px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .summary-value {
            color: var(--accent-color);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            h1 {
                font-size: 1.8rem;
                margin-bottom: 24px;
            }
            
            .form-grid {
                grid-template-columns: repeat(3, 1fr); /* Keep 3 columns on all screens */
                gap: 10px; /* Smaller gap */
                padding: 15px;
            }
            
            label {
                font-size: 0.7rem; /* Smaller labels on medium screens */
                margin-bottom: 5px;
            }
            
            input, select, button {
                padding: 10px; /* Smaller padding */
                font-size: 0.85rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 12px 6px; /* Reduced horizontal padding */
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn-small {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .form-grid {
                grid-template-columns: repeat(3, 1fr); /* Keep 3 columns on small screens too */
                gap: 8px; /* Even smaller gap */
                padding: 10px;
            }
            
            label {
                font-size: 0.65rem; /* Even smaller labels on small screens */
                margin-bottom: 4px;
            }
            
            input, select, button {
                padding: 8px; /* Smaller padding */
                font-size: 0.8rem;
            }
            
            table {
                font-size: 0.85rem;
            }
            
            th, td {
                padding: 10px 4px; /* Further reduced horizontal padding */
            }
            
            .summary-card {
                padding: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FIRE Calculator</h1>
        
        <div class="form-grid">
            <div class="form-group">
                <label for="currentAge">Age:</label>
                <input type="number" id="currentAge" placeholder="Your age" min="18" max="100" step="1">
            </div>
            
            <div class="form-group">
                <label for="inflation">Inflation (%):</label>
                <input type="number" id="inflation" placeholder="Inflation rate" step="1" value="0">
            </div>
            
            <div class="form-group">
                <label for="currentCorpus">Capital (₹ L):</label>
                <input type="number" id="currentCorpus" placeholder="Current capital in L" step="1">
            </div>
            
            <div class="form-group">
                <label for="incomeTax">Tax Rate (%):</label>
                <input type="number" id="incomeTax" placeholder="Income tax rate" step="1" value="0">
            </div>
            
            <div class="form-group">
                <label for="monthlyReturns">Retn/m (%):</label>
                <input type="number" id="monthlyReturns" placeholder="Monthly returns" step="0.1" value="0.0">
            </div>
            
            <div class="form-group">
                <label for="pensionDrawn">Expns/m (₹ L):</label>
                <input type="number" id="pensionDrawn" placeholder="Monthly expense in L" step="0.1" value="0">
            </div>
        </div>
        
        <div id="resultsSection" style="display: none;">
            <div class="results-table">
                <table id="fireResultsTable">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Capital</th>
                            <th>Int</th>
                            <th>Expns/y</th>
                        </tr>
                    </thead>
                    <tbody id="fireResultsBody">
                    </tbody>
                </table>
            </div>
        
        <!-- Debug table section, initially hidden -->
        <div id="debugSection" style="display: none; margin-top: 20px;">
            <h2>Debug Information</h2>
            <div class="results-table">
                <table id="debugResultsTable">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Withdrawals</th>
                            <th>Interest (Year)</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="debugResultsBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Save and restore form values
        function saveFormValues() {
            const formValues = {
                currentAge: document.getElementById('currentAge').value,
                currentCorpus: document.getElementById('currentCorpus').value,
                incomeTax: document.getElementById('incomeTax').value,
                monthlyReturns: document.getElementById('monthlyReturns').value,
                pensionDrawn: document.getElementById('pensionDrawn').value,
                inflation: document.getElementById('inflation').value
            };
            localStorage.setItem('fireCalculatorFormValues', JSON.stringify(formValues));
        }

        function restoreFormValues() {
            const savedValues = JSON.parse(localStorage.getItem('fireCalculatorFormValues')) || {};
            if (savedValues.currentAge) document.getElementById('currentAge').value = savedValues.currentAge;
            if (savedValues.currentCorpus) document.getElementById('currentCorpus').value = savedValues.currentCorpus;
            if (savedValues.incomeTax) document.getElementById('incomeTax').value = savedValues.incomeTax;
            if (savedValues.monthlyReturns) document.getElementById('monthlyReturns').value = savedValues.monthlyReturns;
            if (savedValues.pensionDrawn) document.getElementById('pensionDrawn').value = savedValues.pensionDrawn;
            if (savedValues.inflation) document.getElementById('inflation').value = savedValues.inflation;
        }

        // Add event listeners to save form values when they change
        document.getElementById('currentAge').addEventListener('input', saveFormValues);
        document.getElementById('currentCorpus').addEventListener('input', saveFormValues);
        document.getElementById('incomeTax').addEventListener('input', saveFormValues);
        document.getElementById('monthlyReturns').addEventListener('input', saveFormValues);
        document.getElementById('pensionDrawn').addEventListener('input', saveFormValues);
        document.getElementById('inflation').addEventListener('input', saveFormValues);

        // Add event listeners to trigger calculation on input changes
        document.getElementById('currentAge').addEventListener('input', calculateFIRE);
        document.getElementById('currentCorpus').addEventListener('input', calculateFIRE);
        document.getElementById('incomeTax').addEventListener('input', calculateFIRE);
        document.getElementById('monthlyReturns').addEventListener('input', calculateFIRE);
        document.getElementById('pensionDrawn').addEventListener('input', calculateFIRE);
        document.getElementById('inflation').addEventListener('input', calculateFIRE);

        // Format currency specifically for the debug table to show in Lakhs
        function formatCurrencyDebug(amount) {
            // Convert to Lakhs by dividing by 100,000
            const amountInLakhs = amount / 100000;
            return amountInLakhs.toFixed(2) + ' L';
        }

        // Debug function to populate HTML debug table
        function populateDebugTable(yearlyData) {
            // Get the debug table body element
            const debugTbody = document.getElementById('debugResultsBody');
            
            // Clear existing content
            debugTbody.innerHTML = '';
            
            // Add each year's data as a row in the table
            for (let i = 0; i < yearlyData.length; i++) {
                const yearData = yearlyData[i];
                const row = document.createElement('tr');
                
                // Apply negative class to balance if it's negative
                const balanceClass = yearData.balance < 0 ? ' class="negative-value"' : '';
                
                row.innerHTML = `
                    <td>${yearData.year}</td>
                    <td>${formatCurrencyDebug(yearData.withdrawals)}</td>
                    <td>${formatCurrencyDebug(yearData.interest)}</td>
                    <td${balanceClass}>${formatCurrencyDebug(yearData.balance)}</td>
                `;
                
                debugTbody.appendChild(row);
            }
            
            // Show the debug section
            document.getElementById('debugSection').style.display = 'block';
        }

        // FIRE Calculator functionality
        // The function is now triggered automatically on input changes

        function calculateFIRE() {
            // Get input values
            const currentAgeInput = document.getElementById('currentAge').value;
            const currentCorpusInput = document.getElementById('currentCorpus').value;
            const currentAge = parseInt(currentAgeInput);
            const currentCorpus = parseFloat(currentCorpusInput);
            const incomeTaxRate = parseFloat(document.getElementById('incomeTax').value) / 100 || 0;
            const monthlyReturnsRate = parseFloat(document.getElementById('monthlyReturns').value) / 100 || 0;
            const monthlyExpenses = parseFloat(document.getElementById('pensionDrawn').value) || 0;
            const inflationRate = parseFloat(document.getElementById('inflation').value) / 100 || 0;

            // Only calculate if all required fields have appropriate values
            if (currentAgeInput === '' || isNaN(currentAge) || currentAge < 18 || currentAge > 100 || 
                currentCorpusInput === '' || isNaN(currentCorpus) || currentCorpus < 0) {
                // Hide results section if inputs are invalid
                document.getElementById('resultsSection').style.display = 'none';
                return;
            }

            // Generate results for specific ages: current age, +5, +10, then 60, 70, 90
            const targetAges = [];
            // Add current age
            targetAges.push(currentAge);
            
            // Add +5 and +10 years if they don't exceed age 100
            if (currentAge + 5 <= 100) {
                targetAges.push(currentAge + 5);
            }
            if (currentAge + 10 <= 100) {
                targetAges.push(currentAge + 10);
            }
            
            // Add milestone ages if not already included and if they're greater than current age
            [60, 70, 90].forEach(age => {
                if (!targetAges.includes(age) && age > currentAge && age <= 100) {
                    targetAges.push(age);
                }
            });

            // Sort ages to ensure proper order
            targetAges.sort((a, b) => a - b);

            // Calculate results for each target age
            const results = [];
            // Store yearly data for each target age for potential debug display
            const allYearlyData = [];
            // Convert values from Lakhs to actual rupees (multiply by 100000)
            const corpusInRupees = currentCorpus * 100000; // Convert corpus from Lakhs to rupees
            const monthlyExpensesInRupees = monthlyExpenses * 100000; // Convert monthly expenses from Lakhs to rupees (1 Lakh = 10000 rupees)
            
            // Starting capital is the current corpus
            let currentCapital = corpusInRupees;

                for (let age of targetAges) {
                    // If the target age is the same as current age, just return the initial capital without calculations
                    if (age === currentAge) {
                        results.push({
                            age: age,
                            capital: corpusInRupees,
                            yearInterest: 0, // No interest calculated for current age
                            annualExpenses: monthlyExpensesInRupees * 12 // Annual expenses at current time
                        });
                        continue; // Skip the rest of the loop for current age
                    }
                    
                    const yearsToTarget = age - currentAge;
                    
                    // Simulate month-by-month from current age to target age
                    let simulatedCapital = currentCapital;
                    let currentMonthlyExpenses = monthlyExpensesInRupees;
                    
                    // Track total interest earned over time for display purposes
                    let totalInterestEarned = 0;
                    let lastYearInterest = 0; // Track the interest from the last year
                    
                    // Array to store yearly data for debugging
                    const yearlyData = [];
                    
                    for (let yr = 0; yr < yearsToTarget; yr++) {
                        // Store starting capital for this year to calculate interest
                        const startOfYearCapital = simulatedCapital;
                        let yearlyInterest = 0; // Track interest earned during this year
                        
                        // Calculate month-by-month for this year with monthly withdrawals
                        for (let month = 0; month < 12; month++) {
                            // Apply monthly return to current balance
                            const monthlyGain = simulatedCapital * monthlyReturnsRate;
                            
                            // Calculate tax on the monthly gain
                            const taxOnGain = monthlyGain * incomeTaxRate;
                            const netGain = monthlyGain - taxOnGain;
                            
                            // Add net gain to capital
                            simulatedCapital += netGain;
                            
                            // Add to yearly interest
                            yearlyInterest += netGain;
                            
                            // Subtract monthly expenses from capital
                            simulatedCapital -= currentMonthlyExpenses;
                        }
                        
                        totalInterestEarned += yearlyInterest;
                        lastYearInterest = yearlyInterest; // Store the interest from the last processed year
                        
                        // Store yearly data for debugging
                        yearlyData.push({
                            year: currentAge + yr, // Calendar year for this iteration
                            withdrawals: currentMonthlyExpenses * 12, // Amount withdrawn for expenses
                            interest: yearlyInterest, // Interest earned during the year
                            accruedInterest: totalInterestEarned, // Total interest accumulated to date
                            balance: simulatedCapital // Balance at the end of the year
                        });
                        
                        // Increase monthly expenses for inflation for the next year
                        currentMonthlyExpenses *= (1 + inflationRate);
                    }
                    
                    // Calculate annual expenses adjusted for inflation at this age for display purposes
                    let annualExpensesAtAge = monthlyExpensesInRupees * 12;
                    if (inflationRate > 0 && yearsToTarget > 0) {
                        annualExpensesAtAge = monthlyExpensesInRupees * 12 * Math.pow(1 + inflationRate, yearsToTarget);
                    }
                    
                    results.push({
                        age: age,
                        capital: simulatedCapital,
                        yearInterest: lastYearInterest, // Interest for the last year of the period
                        annualExpenses: annualExpensesAtAge
                    });
                
                // Store the yearly data for this target age
                allYearlyData[age] = yearlyData;
            }
            
            // Populate debug table if debug mode is enabled (only for the last target age calculated)
            if (typeof DEBUG_MODE !== 'undefined' && DEBUG_MODE && results.length > 0) {
                // Get the yearly data for the last calculated target age
                const lastTargetAge = targetAges[targetAges.length - 1];
                const finalYearlyData = allYearlyData[lastTargetAge];
                populateDebugTable(finalYearlyData);
            } else {
                // Hide debug section if debug mode is not enabled
                document.getElementById('debugSection').style.display = 'none';
            }

            // Update results table
            const tbody = document.getElementById('fireResultsBody');
            tbody.innerHTML = '';

            results.forEach(result => {
                const row = document.createElement('tr');
                
                // Apply negative class to capital if it's negative
                const capitalClass = result.capital < 0 ? ' class="negative-value"' : '';
                
                row.innerHTML = `
                    <td>${result.age}</td>
                    <td${capitalClass}>${formatCurrency(result.capital)}</td>
                    <td${capitalClass}>${formatCurrency(result.yearInterest)}</td>
                    <td>${formatCurrencyInLakhs(result.annualExpenses)}</td>
                `;
                
                tbody.appendChild(row);
            });

            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
        }

        // Format currency to show in lakhs (L) or thousands (K)
        function formatCurrency(amount) {
            let formattedAmount;
            if (Math.abs(amount) >= 10000) { // >= 1 Cr (1,00,00,000 = 1 Cr)
                formattedAmount = (amount / 10000000).toFixed(2) + ' Cr';
            } else if (Math.abs(amount) >= 100000) {  // >= 1 L (1,00,000 = 1 L) but < 1 Cr
                formattedAmount = (amount / 100000).toFixed(2) + ' L';
            } else if (Math.abs(amount) >= 1000) {
                formattedAmount = (amount / 1000).toFixed(2) + ' K';
            } else {
                formattedAmount = amount.toFixed(2);
            }
            return formattedAmount;
        }

        // Format currency specifically for expenses to show in lakhs
        function formatCurrencyInLakhs(amount) {
            // Convert the amount to lakhs by dividing by 100000
            const amountInLakhs = amount / 100000;
            return amountInLakhs.toFixed(2) + ' L';
        }

        // Initialize calculator when page loads
        document.addEventListener('DOMContentLoaded', function() {
            restoreFormValues();
            // Trigger calculation to initialize the table if form values exist
            calculateFIRE();
        });

        // The calculator now updates automatically on input changes
        
        // To enable debug mode, set window.DEBUG_MODE = true in the browser console
        // This will print year-wise breakdown to the console when calculations are performed
        // Example: In browser console, type "DEBUG_MODE = true" and press Enter
        // Then interact with the calculator to see debug output
    </script>
    
    <div style="position: fixed; bottom: 10px; width: 100%; text-align: center; color: var(--text-secondary); font-size: 0.7rem; padding: 0 20px;">
        <p>Assumes current year as retirement year. Preserves data in browser.</p>
    </div>
</body>
</html>
